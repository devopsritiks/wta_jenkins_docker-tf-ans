- name: Wait N seconds for port 22 to become open and contain "OpenSSH"
  hosts: all
  gather_facts: False
  tasks:
   - wait_for:
       port: 22
       host: '{{ (ansible_ssh_host|default(ansible_host))|default(inventory_hostname) }}'
       search_regex: OpenSSH
       delay: 10
       timeout: 100
  vars:
    ansible_connection: local

- name: Install docker, docker-compose
  hosts: all
  become: yes
  gather_facts: False
  tasks:
    - name: Update repositories cache and install "foo" package
      ansible.builtin.apt:
        name: docker.io
        update_cache: yes

- name: Add ubuntu to docker group
  hosts: all
  become: yes
  tasks:
    - name: Add ubuntu to docker group
      user:
        name: ubuntu
        groups: docker
        append: yes
    - name: Reconnect to server session
      meta: reset_connection

